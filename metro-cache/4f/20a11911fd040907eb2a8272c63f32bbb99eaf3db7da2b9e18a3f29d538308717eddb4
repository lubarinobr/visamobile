{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"isAsync":false}},{"name":"@babel/runtime/regenerator","data":{"isAsync":false}},{"name":"@babel/runtime/helpers/classCallCheck","data":{"isAsync":false}},{"name":"@react-native-community/async-storage","data":{"isAsync":false}},{"name":"react-native-firebase","data":{"isAsync":false}},{"name":"../services/api","data":{"isAsync":false}}],"output":[{"data":{"code":"__d(function (global, _$$_REQUIRE, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = _$$_REQUIRE(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = void 0;\n\n  var _regenerator = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[1], \"@babel/runtime/regenerator\"));\n\n  var _classCallCheck2 = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[2], \"@babel/runtime/helpers/classCallCheck\"));\n\n  var _asyncStorage = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[3], \"@react-native-community/async-storage\"));\n\n  var _reactNativeFirebase = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[4], \"react-native-firebase\"));\n\n  var _api = _interopRequireDefault(_$$_REQUIRE(_dependencyMap[5], \"../services/api\"));\n\n  var Notification = function Notification() {\n    var _this = this;\n\n    (0, _classCallCheck2.default)(this, Notification);\n\n    this.init = function _callee() {\n      var isClean,\n          enabled,\n          _args = arguments;\n      return _regenerator.default.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              isClean = _args.length > 0 && _args[0] !== undefined ? _args[0] : false;\n              _context.next = 3;\n              return _regenerator.default.awrap(_reactNativeFirebase.default.messaging().hasPermission());\n\n            case 3:\n              enabled = _context.sent;\n\n              if (enabled) {\n                _this.getToken(isClean);\n              } else {\n                _this.requestPermission();\n              }\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    };\n\n    this.getToken = function _callee2(isClean) {\n      var fcmToken, _fcmToken, _firebase$auth, email, user;\n\n      return _regenerator.default.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              fcmToken = null;\n\n              if (isClean) {\n                _context2.next = 5;\n                break;\n              }\n\n              _context2.next = 4;\n              return _regenerator.default.awrap(_asyncStorage.default.getItem('fcmToken'));\n\n            case 4:\n              _fcmToken = _context2.sent;\n\n            case 5:\n              if (fcmToken) {\n                _context2.next = 16;\n                break;\n              }\n\n              _context2.next = 8;\n              return _regenerator.default.awrap(_reactNativeFirebase.default.messaging().getToken());\n\n            case 8:\n              fcmToken = _context2.sent;\n\n              if (!fcmToken) {\n                _context2.next = 16;\n                break;\n              }\n\n              _firebase$auth = _reactNativeFirebase.default.auth(), email = _firebase$auth.currentUser.email;\n              user = {\n                email: email,\n                messageToken: fcmToken\n              };\n              _context2.next = 14;\n              return _regenerator.default.awrap(_api.default.put(\"/users?email=\" + email, user));\n\n            case 14:\n              _context2.next = 16;\n              return _regenerator.default.awrap(_asyncStorage.default.setItem('fcmToken', fcmToken));\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      });\n    };\n\n    this.requestPermission = function _callee3() {\n      return _regenerator.default.async(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return _regenerator.default.awrap(_reactNativeFirebase.default.messaging().requestPermission());\n\n            case 3:\n              _this.getToken();\n\n              _context3.next = 9;\n              break;\n\n            case 6:\n              _context3.prev = 6;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.log(_context3.t0);\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, null, null, [[0, 6]]);\n    };\n\n    this.saveToken = function _callee4() {\n      return _regenerator.default.async(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      });\n    };\n  };\n\n  exports.default = Notification;\n});","map":[[13,0,1,0],[15,0,2,0],[17,0,3,0],[19,6,5,21,"Notification"],[19,18],[24,9,7,4,"init"],[24,13],[24,16,7,11],[25,0,7,11],[26,0,7,11],[27,0,7,11],[28,0,7,11],[29,0,7,11],[30,0,7,11],[31,0,7,11],[32,0,7,18,"isClean"],[32,14,7,18,"isClean"],[32,21,7,11],[32,80,7,28],[32,85,7,11],[33,0,7,11],[34,0,7,11],[34,48,8,30,"firebase"],[34,77,8,39,"messaging"],[34,86,8,30],[34,89,8,51,"hasPermission"],[34,102,8,30],[34,104,7,11],[36,0,7,11],[37,0,8,14,"enabled"],[37,14,8,14,"enabled"],[37,21,7,11],[39,0,9,8],[39,18,9,11,"enabled"],[39,25,9,8],[39,27,9,20],[40,0,10,12],[40,16,10,12],[40,21,10,16],[40,22,10,17,"getToken"],[40,30,10,12],[40,31,10,26,"isClean"],[40,38,10,12],[41,0,11,9],[41,15,9,8],[41,21,11,14],[42,0,12,12],[42,16,12,12],[42,21,12,16],[42,22,12,17,"requestPermission"],[42,39,12,12],[43,0,13,9],[45,0,7,11],[46,0,7,11],[47,0,7,11],[48,0,7,11],[49,0,7,11],[50,0,7,11],[51,0,7,11],[51,5],[53,9,16,4,"getToken"],[53,17],[53,20,16,15],[53,38,16,22,"isClean"],[53,45,16,15],[54,0,16,15],[56,0,16,15],[57,0,16,15],[58,0,16,15],[59,0,16,15],[60,0,18,12,"fcmToken"],[60,14,18,12,"fcmToken"],[60,22,16,15],[60,25,18,23],[60,29,16,15],[62,0,16,15],[62,18,19,12,"isClean"],[62,25,16,15],[63,0,16,15],[64,0,16,15],[65,0,16,15],[67,0,16,15],[68,0,16,15],[68,48,20,33,"AsyncStorage"],[68,70,20,46,"getItem"],[68,77,20,33],[68,78,20,54],[68,88,20,33],[68,89,16,15],[70,0,16,15],[71,0,20,16,"fcmToken"],[71,14,20,16,"fcmToken"],[71,23,16,15],[73,0,16,15],[74,0,16,15],[74,18,23,12,"fcmToken"],[74,26,16,15],[75,0,16,15],[76,0,16,15],[77,0,16,15],[79,0,16,15],[80,0,16,15],[80,48,24,29,"firebase"],[80,77,24,38,"messaging"],[80,86,24,29],[80,89,24,50,"getToken"],[80,97,24,29],[80,99,16,15],[82,0,16,15],[83,0,24,12,"fcmToken"],[83,14,24,12,"fcmToken"],[83,22,16,15],[85,0,16,15],[85,19,25,15,"fcmToken"],[85,27,16,15],[86,0,16,15],[87,0,16,15],[88,0,16,15],[90,0,16,15],[90,31,26,49,"firebase"],[90,60,26,58,"auth"],[90,64,26,49],[90,66,16,15],[90,68,26,38,"email"],[90,73,16,15],[90,91,26,24,"currentUser"],[90,102,16,15],[90,103,26,38,"email"],[90,108,16,15],[91,0,27,20,"user"],[91,14,27,20,"user"],[91,18,16,15],[91,21,27,27],[92,0,27,28,"email"],[92,16,27,28,"email"],[92,21,27,33],[92,23,27,28,"email"],[92,28,27,27],[93,0,27,35,"messageToken"],[93,16,27,35,"messageToken"],[93,28,27,47],[93,30,27,49,"fcmToken"],[94,0,27,27],[94,15,16,15],[95,0,16,15],[96,0,16,15],[96,48,28,22,"api"],[96,61,28,26,"put"],[96,64,28,22],[96,83,28,46,"email"],[96,88,28,22],[96,90,28,55,"user"],[96,94,28,22],[96,95,16,15],[98,0,16,15],[99,0,16,15],[100,0,16,15],[100,48,29,22,"AsyncStorage"],[100,70,29,35,"setItem"],[100,77,29,22],[100,78,29,43],[100,88,29,22],[100,90,29,55,"fcmToken"],[100,98,29,22],[100,99,16,15],[102,0,16,15],[103,0,16,15],[104,0,16,15],[105,0,16,15],[106,0,16,15],[107,0,16,15],[108,0,16,15],[108,5],[110,9,34,4,"requestPermission"],[110,26],[110,29,34,24],[111,0,34,24],[112,0,34,24],[113,0,34,24],[114,0,34,24],[115,0,34,24],[116,0,34,24],[117,0,34,24],[117,48,36,18,"firebase"],[117,77,36,27,"messaging"],[117,86,36,18],[117,89,36,39,"requestPermission"],[117,106,36,18],[117,108,34,24],[119,0,34,24],[120,0,38,12],[120,14,38,12],[120,19,38,16],[120,20,38,17,"getToken"],[120,28,38,12],[122,0,34,24],[123,0,34,24],[125,0,34,24],[126,0,34,24],[127,0,34,24],[128,0,40,12,"console"],[128,14,40,12,"console"],[128,21,40,19],[128,22,40,20,"log"],[128,25,40,12],[130,0,34,24],[131,0,34,24],[132,0,34,24],[133,0,34,24],[134,0,34,24],[135,0,34,24],[136,0,34,24],[136,5],[138,9,44,4,"saveToken"],[138,18],[138,21,44,16],[139,0,44,16],[140,0,44,16],[141,0,44,16],[142,0,44,16],[143,0,44,16],[144,0,44,16],[145,0,44,16],[146,0,44,16],[147,0,44,16],[148,0,44,16],[148,5]]},"type":"js/module"}]}